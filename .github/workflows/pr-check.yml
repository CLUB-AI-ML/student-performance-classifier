name: PR Submission Check

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  evaluate-submission:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Execute student notebook
        run: |
          jupyter nbconvert --to notebook --execute notebooks/student_analysis.ipynb --output notebooks/student_analysis_executed.ipynb
        continue-on-error: true

      - name: Run evaluation script
        id: eval
        # We redirect the python output to a file so we can upload it
        run: python scripts/evaluate_submission.py > evaluation_result.txt
        continue-on-error: true

      - name: Save PR Number
        # We need to save the PR number so the next workflow knows where to comment
        run: echo ${{ github.event.number }} > pr_number.txt

      - name: Upload Evaluation Results
        uses: actions/upload-artifact@v4
        with:
          name: submission-results
          path: |
            evaluation_result.txt
            pr_number.txt
